<div class="code-page">
  <div class="code-card">
    <div class="code-toolbar">
      <div class="toolbar-left">
        <button class="back-btn" (click)="goBack()">‚Üê</button>
        <h2>üìÅ File Numbers</h2>
        <span class="record-count">{{ filtered.length }} records</span>
      </div>
      <div class="toolbar-right">
        <button class="btn-add" (click)="openAdd()">Ôºã Add New File</button>
      </div>
    </div>
    <div class="code-table-wrap">
      <div class="table-search">
        <span class="search-icon">üîç</span>
        <input type="text" [(ngModel)]="searchTerm" placeholder="Search files...">
      </div>
      <table class="code-table">
        <thead>
          <tr>
            <th>File Number</th>
            <th>File Name</th>
            <th>Agent</th>
            <th>Period</th>
            <th>Status</th>
            <th>Record Time</th>
            <th style="width:90px">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of filtered">
            <td><strong>{{ item.fileNumber }}</strong></td>
            <td>{{ item.fileName }}</td>
            <td>{{ item.agentName }}</td>
            <td>{{ item.periodName }}</td>
            <td>
              <span [class]="item.active ? 'status-active' : 'status-inactive'">
                {{ item.active ? 'Active' : 'Inactive' }}
              </span>
            </td>
            <td>{{ item.recordTime | date:'yyyy-MM-dd HH:mm' }}</td>
            <td>
              <div class="actions-cell">
                <button class="action-btn edit-btn" (click)="openEdit(item)">‚úèÔ∏è</button>
                <button class="action-btn delete-btn" (click)="confirmDelete(item)">üóëÔ∏è</button>
              </div>
            </td>
          </tr>
          <tr *ngIf="filtered.length === 0">
            <td colspan="7" class="empty-row">No file numbers found</td>
          </tr>
        </tbody>
      </table>
      <div class="table-footer">
        <span class="records-info">Showing {{ filtered.length }} of {{ items.length }} records</span>
      </div>
    </div>
  </div>

  <!-- Add/Edit Modal -->
  <app-modal [title]="isEdit ? 'Edit File' : 'Add New File'" [isOpen]="isModalOpen" (closed)="closeModal()" size="medium">
    <div class="modal-form">
      <div class="form-row">
        <div class="form-group">
          <label>File Number *</label>
          <input type="text" [(ngModel)]="model.fileNumber" placeholder="e.g. 2024-01-001">
        </div>
        <div class="form-group">
          <label>File Name *</label>
          <input type="text" [(ngModel)]="model.fileName" placeholder="Enter file name">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Agent</label>
          <select [(ngModel)]="model.agentId">
            <option [ngValue]="undefined" disabled>Select agent</option>
            <option *ngFor="let a of agents" [ngValue]="a.agentId">
              {{ a.agentName }}
            </option>
          </select>
        </div>
        <div class="form-group">
          <label>Period</label>
          <select [(ngModel)]="model.periodId">
            <option [ngValue]="undefined" disabled>Select period</option>
            <option *ngFor="let p of periods" [ngValue]="p.periodId">
              {{ p.periodName }}
            </option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="model.active">
            Active
          </label>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-save" (click)="save()" [disabled]="saving">{{ isEdit ? 'üíæ Update File' : 'Ôºã Add File' }}</button>
      <button class="btn-cancel-modal" (click)="closeModal()">Cancel</button>
    </div>
  </app-modal>

  <!-- Delete Confirmation -->
  <app-confirm-dialog
    [isOpen]="showDeleteConfirm"
    [itemName]="deleteTarget?.fileName || ''"
    (confirmed)="onDeleteConfirmed()"
    (cancelled)="onDeleteCancelled()">
  </app-confirm-dialog>
</div>