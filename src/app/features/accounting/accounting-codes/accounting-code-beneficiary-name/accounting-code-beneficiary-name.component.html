<div class="code-page">
  <div class="code-card">
    <div class="code-toolbar">
      <div class="toolbar-left">
        <button class="back-btn" (click)="goBack()">‚Üê</button>
        <h2>üë§ Beneficiary Names</h2>
        <span class="record-count">{{ filtered.length }} records</span>
      </div>
      <div class="toolbar-right">
        <button class="btn-add" (click)="openAdd()">Ôºã Add New Beneficiary</button>
      </div>
    </div>
    <div class="code-table-wrap">
      <div class="table-search">
        <span class="search-icon">üîç</span>
        <input type="text" [(ngModel)]="searchTerm" placeholder="Search beneficiaries...">
      </div>
      <table class="code-table">
        <thead>
          <tr>
            <th>Beneficiary Name</th>
            <th>Type</th>
            <th>Commercial Name</th>
            <th>VAT No</th>
            <th>File No</th>
            <th>Phone</th>
            <th>Status</th>
            <th style="width:90px">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of filtered">
            <td><strong>{{ item.beneficiaryName }}</strong></td>
            <td>{{ item.beneficiaryTypeName }}</td>
            <td>{{ item.commercialName }}</td>
            <td>{{ item.vatNo }}</td>
            <td>{{ item.fileNo }}</td>
            <td>{{ item.phone }}</td>
            <td>
              <span [class]="item.active ? 'status-active' : 'status-inactive'">
                {{ item.active ? 'Active' : 'Inactive' }}
              </span>
            </td>
            <td>
              <div class="actions-cell">
                <button class="action-btn edit-btn" (click)="openEdit(item)">‚úèÔ∏è</button>
                <button class="action-btn delete-btn" (click)="confirmDelete(item)">üóëÔ∏è</button>
              </div>
            </td>
          </tr>
          <tr *ngIf="filtered.length === 0">
            <td colspan="8" class="empty-row">No beneficiaries found</td>
          </tr>
        </tbody>
      </table>
      <div class="table-footer">
        <span class="records-info">Showing {{ filtered.length }} of {{ items.length }} records</span>
        <app-export-buttons [data]="filtered"></app-export-buttons>
      </div>
    </div>
  </div>

  <!-- Add/Edit Modal -->
  <app-modal [title]="isEdit ? 'Edit Beneficiary' : 'Add New Beneficiary'" [isOpen]="isModalOpen" (closed)="closeModal()" size="medium">
    <div class="modal-form">
      <div class="form-row">
        <div class="form-group">
          <label>Beneficiary Name *</label>
          <input type="text" [(ngModel)]="model.beneficiaryName" placeholder="Enter beneficiary name">
        </div>
        <div class="form-group">
          <label>Beneficiary Type *</label>
          <select [(ngModel)]="model.beneficiaryTypeId">
            <option [ngValue]="undefined" disabled>Select type</option>
            <option *ngFor="let type of beneficiaryTypes" [ngValue]="type.beneficiaryTypeId">
              {{ type.beneficiaryTypeName }}
            </option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Commercial Name</label>
          <input type="text" [(ngModel)]="model.commercialName" placeholder="Enter commercial name">
        </div>
        <div class="form-group">
          <label>VAT No</label>
          <input type="text" [(ngModel)]="model.vatNo" placeholder="Enter VAT number">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>File No</label>
          <input type="text" [(ngModel)]="model.fileNo" placeholder="Enter file number">
        </div>
        <div class="form-group">
          <label>Phone</label>
          <input type="text" [(ngModel)]="model.phone" placeholder="Enter phone">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Address</label>
          <input type="text" [(ngModel)]="model.address" placeholder="Enter address">
        </div>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="model.active">
            Active
          </label>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-save" (click)="save()" [disabled]="saving">{{ isEdit ? 'üíæ Update Beneficiary' : 'Ôºã Add Beneficiary' }}</button>
      <button class="btn-cancel-modal" (click)="closeModal()">Cancel</button>
    </div>
  </app-modal>

  <!-- Delete Confirmation -->
  <app-confirm-dialog
    [isOpen]="showDeleteConfirm"
    [itemName]="deleteTarget?.beneficiaryName || ''"
    (confirmed)="onDeleteConfirmed()"
    (cancelled)="onDeleteCancelled()">
  </app-confirm-dialog>
</div>